<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL to Google Drive Saver</title>
    <style>
        :root { --primary: #4F46E5; --bg: #F3F4F6; --card: #ffffff; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: var(--card); padding: 2rem; border-radius: 1rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); width: 90%; max-width: 500px; }
        h1 { color: #111827; margin-bottom: 0.5rem; font-size: 1.5rem; text-align: center; }
        p { color: #6B7280; text-align: center; margin-bottom: 1.5rem; font-size: 0.9rem; }
        .input-group { margin-bottom: 1rem; }
        input { width: 100%; padding: 0.75rem; border: 1px solid #D1D5DB; border-radius: 0.5rem; box-sizing: border-box; outline: none; transition: border 0.2s; }
        input:focus { border-color: var(--primary); ring: 2px var(--primary); }
        button { width: 100%; background: var(--primary); color: white; padding: 0.75rem; border: none; border-radius: 0.5rem; font-weight: 600; cursor: pointer; transition: opacity 0.2s; }
        button:hover { opacity: 0.9; }
        button:disabled { background: #9CA3AF; cursor: not-allowed; }
        #status { margin-top: 1rem; padding: 1rem; border-radius: 0.5rem; background: #F9FAFB; border: 1px solid #E5E7EB; white-space: pre-wrap; word-break: break-all; font-size: 0.9rem; display: none; }
        .success { border-left: 4px solid #10B981 !important; color: #065F46; }
        .error { border-left: 4px solid #EF4444 !important; color: #7F1D1D; }
        .spinner { display: inline-block; width: 1rem; height: 1rem; border: 2px solid #fff; border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; margin-right: 0.5rem; vertical-align: middle; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="container">
    <h1>â˜ï¸ URL è½¬å­˜åŠ©æ‰‹</h1>
    <p>ç›´æ¥å°†ç½‘ç»œæ–‡ä»¶ä¿å­˜åˆ°æ‚¨çš„ Google Drive</p>
    
    <div class="input-group">
        <input type="url" id="fileUrl" placeholder="åœ¨æ­¤ç²˜è´´æ–‡ä»¶ URL (ä¾‹å¦‚ .mp4, .zip)" required>
    </div>
    
    <button id="submitBtn" onclick="startUpload()">
        <span id="btnText">å¼€å§‹è½¬å­˜</span>
    </button>
    
    <div id="status"></div>
</div>

<!-- å¼•å…¥ Gradio Client -->
<script type="module">
    import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js";
    
    // âš ï¸âš ï¸âš ï¸ã€é‡è¦ã€‘è¯·åœ¨æ­¤å¤„æ›¿æ¢ä¸ºæ‚¨çš„ Hugging Face Space ID âš ï¸âš ï¸âš ï¸
    // æ ¼å¼: "ç”¨æˆ·å/ç©ºé—´å"
    const HF_SPACE_ID = "iyougame/url2drive"; 

    window.startUpload = async function() {
        const urlInput = document.getElementById('fileUrl');
        const btn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const statusDiv = document.getElementById('status');
        
        const url = urlInput.value.trim();
        if (!url) {
            alert("è¯·è¾“å…¥æœ‰æ•ˆçš„æ–‡ä»¶ URL");
            return;
        }

        // UI Reset
        btn.disabled = true;
        btnText.innerHTML = '<span class="spinner"></span> å¤„ç†ä¸­...';
        statusDiv.style.display = 'block';
        statusDiv.className = '';
        statusDiv.innerHTML = "â³ æ­£åœ¨è¿æ¥åç«¯æœåŠ¡å™¨...";

        try {
            // 1. è¿æ¥ Space
            const client = await Client.connect(HF_SPACE_ID);
            
            statusDiv.innerHTML = "ğŸš€ å·²è¿æ¥! æ­£åœ¨ä¸‹è½½å¹¶ä¸Šä¼ ...";
            
            // 2. è°ƒç”¨ API (api_name å¯¹åº” app.py ä¸­çš„ api_name="save_to_drive")
            const result = await client.predict("/save_to_drive", { 
                file_url: url 
            });

            // 3. å¤„ç†ç»“æœ
            const responseText = result.data[0]; // Gradio è¿”å›çš„æ˜¯æ•°ç»„
            
            // ç®€å•çš„ Markdown è§£æ
            let htmlContent = responseText
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank" style="color:blue;text-decoration:underline;">$1</a>') // Link
                .replace(/\n/g, '<br>'); // Newline

            statusDiv.innerHTML = htmlContent;

            if (responseText.includes("âŒ")) {
                statusDiv.classList.add("error");
                btnText.innerText = "é‡è¯•";
            } else {
                statusDiv.classList.add("success");
                btnText.innerText = "å†æ¬¡è½¬å­˜";
                urlInput.value = ""; // Clear input on success
            }

        } catch (error) {
            console.error(error);
            statusDiv.classList.add("error");
            statusDiv.innerHTML = `âŒ **ç³»ç»Ÿé”™è¯¯**: ${error.message}<br>è¯·æ£€æŸ¥ Space æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚`;
            btnText.innerText = "é‡è¯•";
        } finally {
            btn.disabled = false;
        }
    }
</script>

</body>
</html>
